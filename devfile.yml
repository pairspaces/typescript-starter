schemaVersion: 2.2.0
metadata:
  name: pairspaces-dev
variables:
  TOKEN: eyJraWQiOiJDRXcyd1gxc2swd3VJUkVBUjc4OHBlTitxTys3V3NlXC9hK3BXWEpWelhTdz0iLCJhbGciOiJSUzI1NiJ9.eyJzdWIiOiI3cGlycTg0cHNmbzJhbnZmbXIwYzV0M24zdiIsInRva2VuX3VzZSI6ImFjY2VzcyIsInNjb3BlIjoicHNfYnVpbGRcL3dyaXRlOnNlcnZpY2VzIiwiYXV0aF90aW1lIjoxNzU0NjcxMzA1LCJpc3MiOiJodHRwczpcL1wvY29nbml0by1pZHAudXMtZWFzdC0xLmFtYXpvbmF3cy5jb21cL3VzLWVhc3QtMV9jSE1NNWE4cmsiLCJleHAiOjE3NTQ2NzQ5MDUsImlhdCI6MTc1NDY3MTMwNSwidmVyc2lvbiI6MiwianRpIjoiYjFjOTZjMjYtNzE2MS00Y2FlLTg5NGYtMTRkMDJmMmViMzU0IiwiY2xpZW50X2lkIjoiN3BpcnE4NHBzZm8yYW52Zm1yMGM1dDNuM3YifQ.yVbtxqJl-N5jgKAJc4jsXqemucyMGkfWNGqMJD23WrsSoh4Wx3z3jrp6HAyu6G_sYITsoXWGWlNK6U4RfPfYZ7Xvc9zn5pOlxv82S1ergKRw4rL73CLMV2_8c2oRRjlnShufG7QNbaAruJ9Azo1O9tLE6JCPaxF2laZsLHkZ04rRsnrx8LfLk_rmR8-TCuJqOnWa-VZAV1NT-vZyieJGT7X9QCxv4hEQeytqp-nnHB1lopoZ4iBrCFgJEAlN2GLEn5BJk_qGznxW1XgZg9Kv2SRSyAtGK57ovFxPYI6ALY6j8JqZSwGcib4Bber3nuQLlMxt3ulpTVYK08hsr3kFCg

components:
  - name: user-dev
    container:
      image: node:18
      mountSources: true
      env:
        - name: TOKEN
          value: ${TOKEN}
      command: ["sleep"]
      args: ["infinity"]

  - name: pairspaces
    container:
      image: pairspaces/devfile-image:build
      mountSources: false

commands:
  - id: install-pair
    exec:
      component: user-dev
      commandLine: curl -fsSL https://raw.githubusercontent.com/pairspaces/install/build/install.sh | bash
      group:
        kind: build

  - id: bootstrap
    exec:
      component: user-dev
      commandLine: pair spaces bootstrap ${TOKEN}
      workingDir: /projects
      group:
        kind: run
        isDefault: true

events:
  postStart:
    - install-pair
    - bootstrap
